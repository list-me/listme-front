import { useEffect, useState } from "react";
import { useLocation } from "react-router-dom";
import { toast } from "react-toastify";
import TemplateDefault from "../../components/TemplateDefault";

import { TitlePage } from "../templates/styles";
import {
  BoxesIntegration,
  ContainerContent,
  ContainerIntegration,
  ContentIntegration,
  TitleSwitchContainer,
} from "./styles";
import HeaderSelect from "../../components/Integration/HeaderSelect";
import InlineMenu from "../../components/Integration/InlineMenu";
import DualSwitch from "../../components/Integration/DualSwitch";
import Menus from "../../utils/Integration/Menus";
import FormIntegration from "../../components/Integration/FormIntegration";
import { useIntegration } from "../../context/IntegrationContext";
import { IMenuActivated } from "./companyIntegration";
import IntegrationNavigate from "../../components/Integration/IntegrationNavigate";
import { integrationsRequest } from "../../services/apis/requests/integration";

function Integration(): JSX.Element {
  const location = useLocation();
  const integrationId = location.pathname.split("/").pop();
  console.log("üöÄ ~ Integration ~ integrationId:", integrationId);
  const [headerSelectValue, setHeaderSelectValue] = useState<{
    value: string;
    label: string;
  } | null>(null);

  const [menuActivated, setMenuActivated] =
    useState<IMenuActivated>("BrandConfiguration");

  const menus: {
    value: string;
    label: string;
    status: "incomplete" | "done" | "";
  }[] = [
    {
      value: "BrandConfiguration",
      label: "Config. de Marca",
      status: "done",
    },
    {
      value: "product_categories",
      label: "Config. de Categorias",
      status: "incomplete",
    },
    {
      value: "FeatureConfiguration",
      label: "Config. de Caracter√≠sticas",
      status: "incomplete",
    },
    {
      value: "ProductConfiguration",
      label: "Config. de Produtos",
      status: "incomplete",
    },
    {
      value: "SKUConfiguration",
      label: "Config. de SKU",
      status: "incomplete",
    },
  ];

  const headerOptions = [
    { label: "op1", value: "op1" },
    { label: "op2", value: "op2" },
    { label: "op3", value: "op3" },
    { label: "op4", value: "op4" },
  ];
  const { environment, setEnvironment } = useIntegration();

  const dualOptions = [
    { label: "Homologa√ß√£o", value: "HOMOLOG" },
    { label: "Produ√ß√£o", value: "PROD" },
  ];

  const nextMenu: {
    [key: string]: { value: IMenuActivated; label: string } | null;
  } = {
    product_categories: {
      value: "FeatureConfiguration",
      label: "Config. de Caracter√≠sticas",
    },
    BrandConfiguration: {
      value: "product_categories",
      label: "Config. de Categorias",
    },
    ProductConfiguration: {
      value: "SKUConfiguration",
      label: "Config. de SKU",
    },
    FeatureConfiguration: {
      value: "ProductConfiguration",
      label: "Config. de Produtos",
    },
    SKUConfiguration: null,
  };

  async function getConfigTemplatesById(id: string): Promise<void> {
    try {
      const configTemplatesById =
        await integrationsRequest.listConfigTemplatesId(id);
      console.log(
        "üöÄ ~ getConfigTemplatesById ~ configTemplatesById:",
        configTemplatesById,
      );

      // setListDataCard(configTemplatesList);
    } catch (error) {
      console.error(error);
      toast.error("Ocorreu um erro ao buscar a lista de integra√ß√µes");
    }
  }

  useEffect(() => {
    if (integrationId) {
      getConfigTemplatesById(integrationId);
    }
  }, [integrationId]);

  return (
    <TemplateDefault handleGetTemplates={() => ""}>
      <ContainerContent>
        <ContentIntegration>
          <TitleSwitchContainer>
            <TitlePage>
              <span>Integrando com a</span> Nexaas
            </TitlePage>
            <DualSwitch
              value={environment}
              options={dualOptions}
              setValue={setEnvironment as any}
            />
          </TitleSwitchContainer>
          <BoxesIntegration>
            <ContainerIntegration>
              <InlineMenu
                menus={menus}
                menuActivated={menuActivated}
                setMenuActivated={setMenuActivated}
              />
              <HeaderSelect
                headerSelectValue={headerSelectValue}
                setHeaderSelectValue={setHeaderSelectValue}
                label={`Selecione o cat√°logo de "${Menus[menuActivated]}"`}
                placeHolder="Selecione"
                options={headerOptions}
                required
              />
              {/* <FormIntegration menuActivated={menuActivated} /> */}
              <IntegrationNavigate
                external={false}
                nextMenu={nextMenu[menuActivated]}
                setNextMenu={setMenuActivated}
              />
            </ContainerIntegration>
            <ContainerIntegration>
              <HeaderSelect
                headerSelectValue={headerSelectValue}
                setHeaderSelectValue={setHeaderSelectValue}
                label={`Selecione o cat√°logo de "${Menus[menuActivated]}"`}
                placeHolder="Selecione"
                options={headerOptions}
                required
              />
              {/* <FormIntegration menuActivated={menuActivated} /> */}
            </ContainerIntegration>
            <IntegrationNavigate
              external
              nextMenu={nextMenu[menuActivated]}
              setNextMenu={setMenuActivated}
            />
          </BoxesIntegration>
        </ContentIntegration>
      </ContainerContent>
    </TemplateDefault>
  );
}

export default Integration;
